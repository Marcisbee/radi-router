{"version":3,"sources":["dist/radi-router.js"],"names":["global","factory","exports","module","define","amd","this","radi","COLON","charCodeAt","cr","crg","lr","ld","parseRoute","route","parts","split","end","p","i","length","push","substr","RegExp","join","Route","[object Object]","curr","match","routes","key","m","path","params","cmp","default","src","ro","getRoute","Object","keys","arr","len","ret","Array","parseAllRoutes","cahnged","test","window","r_routes","r_before","beforeEach","r_after","afterEach","conds","concat","fn","component","name","view","Function","state","location","hash","last","active","actions","onhashchange","hashChange","a","version"],"mappings":"CAAC,SAAUA,EAAQC,GACC,iBAAZC,SAA0C,oBAAXC,OAAyBF,EAAQC,SACrD,mBAAXE,QAAyBA,OAAOC,KACtCJ,EAASD,EAAO,mBAHlB,CAIEM,KAAM,SAAWJ,GAAW,aAG9B,IAAIK,EAEJ,MAAMC,EAAQ,IAAIC,WAAW,GAC7B,IAAIC,EACAC,EACAC,EACAC,EAEJ,SAASC,EAAWC,GAEnB,IADA,IAAIC,EAAQD,EAAME,MAAM,KAAMC,KAAUC,KAC/BC,EAAI,EAAGA,EAAIJ,EAAMK,OAAQD,IAC7BZ,IAAUQ,EAAMI,GAAGX,WAAW,IACjCS,EAAII,KAAK,YACTH,EAAEG,KAAKN,EAAMI,GAAGG,OAAO,KACA,KAAbP,EAAMI,IAChBF,EAAII,KAAKN,EAAMI,IAGjB,OAAQ,IAAII,OAAO,KAAON,EAAIO,KAAK,KAAO,eAAiB,KAAMN,SAY5DO,EACLC,YAAYC,EAAMC,EAAOC,EAAQC,GAChC,IAAIC,EAAIJ,EAAKC,MAAMA,EAAM,IACzBvB,KAAK2B,KAAOL,EACZtB,KAAKyB,IAAMA,EACXzB,KAAK4B,UACL,IAAK,IAAId,EAAI,EAAGA,EAAIS,EAAM,GAAGR,OAAQD,IACpCd,KAAK4B,OAAOL,EAAM,GAAGT,IAAMY,EAAEZ,EAAI,GAElCd,KAAK6B,IAAML,EAAOC,IAyEpB7B,EAAQkC,QArER,SAAgBC,GAEd,OADA9B,EAAO8B,EACA,SAASC,GACf,SAASC,EAASX,GACjB,GAAIhB,IAAOgB,EAAM,OAAOf,EACnBH,IAAIA,EAAK8B,OAAOC,KAAKH,EAAGR,SACxBnB,IAAKA,EA5Bd,SAAwB+B,GAEvB,IADA,IAAIC,EAAMD,EAAIrB,OAAQuB,EAAM,IAAIC,MAAMF,GAC7BvB,EAAIuB,EAAM,EAAGvB,GAAK,EAAGA,IAC7BwB,EAAIxB,GAAKN,EAAW4B,EAAItB,IAEzB,OAAOwB,EAuBYE,CAAepC,IAG/B,IAFD,IAAIqC,GAAU,EAEJ3B,EAAI,EAAGA,EAAIT,EAAIU,OAAQD,IAC/B,GAAIT,EAAIS,GAAG,GAAG4B,KAAKpB,GAAO,CACzBf,EAAK,IAAIa,EAAME,EAAMjB,EAAIS,GAAIkB,EAAGR,OAAQpB,EAAGU,IAC5C2B,GAAU,EACT,MASF,OANIA,IACJlC,GACCkB,IAAK,YAGPnB,EAAKgB,EACGf,EAIPoC,OAAOC,SAAWZ,EAAGR,OACrBmB,OAAOE,SAAWb,EAAGc,aAAc,EACnCH,OAAOI,QAAUf,EAAGgB,WAAa,KAEjC,IAAIC,EAAQ,GACZ,IAAK,IAAIxC,KAASuB,EAAGR,OACnByB,EAAQA,EAAMC,4CACSzC,yCAA6CA,oEACjBA,yDAGvC,KAAVwC,IAAcA,EAAQA,EAAMC,OAAO,gCAEvC,IAAIC,qBAAwBF,KAE5B,OAAOhD,EAAKmD,WACVC,KAAM,cACNC,KAAM,IAAIC,SAASJ,GACnBK,OAEEC,SAAUd,OAAOc,SAASC,KAAKzC,OAAO,IAAM,IAC5C0C,KAAM,KACNC,OAAQ,MAEVC,SACExC,UACEsB,OAAOmB,aAAe9D,KAAK+D,WAC3B/D,KAAK+D,cAEP1C,aACHrB,KAAK2D,KAAO3D,KAAKyD,SACZzD,KAAKyD,SAAWd,OAAOc,SAASC,KAAKzC,OAAO,IAAM,IAClD,IAAI+C,EAAI/B,EAASjC,KAAKyD,UAClBO,IACFhE,KAAK4D,OAASI,EAAEvC,WAW5B7B,EAAQqE,QAnHQ","sourcesContent":["(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n\ttypeof define === 'function' && define.amd ? define(['exports'], factory) :\n\t(factory((global['radi-router'] = {})));\n}(this, (function (exports) { 'use strict';\n\nconst version = '0.1.2';\nvar radi;\n\nconst COLON = ':'.charCodeAt(0);\nvar cr;\nvar crg;\nvar lr;\nvar ld;\n\nfunction parseRoute(route) {\n\tvar parts = route.split('/'), end = [], p = [];\n\tfor (var i = 0; i < parts.length; i++) {\n\t\tif (COLON === parts[i].charCodeAt(0)) {\n\t\t\tend.push('([^\\/]+?)');\n\t\t\tp.push(parts[i].substr(1));\n\t\t} else if (parts[i] !== '') {\n\t\t\tend.push(parts[i]);\n\t\t}\n\t}\n\treturn [new RegExp('^/' + end.join('/') + '(?:\\/(?=$))?$', 'i'), p]\n}\n\nfunction parseAllRoutes(arr) {\n\tvar len = arr.length, ret = new Array(len);\n\tfor (var i = len - 1; i >= 0; i--) {\n\t\tret[i] = parseRoute(arr[i]);\n\t}\n\treturn ret\n}\n\n// TODO: Get rid of class\nclass Route {\n\tconstructor(curr, match, routes, key) {\n\t\tvar m = curr.match(match[0]);\n\t\tthis.path = curr;\n\t\tthis.key = key;\n\t\tthis.params = {};\n\t\tfor (var i = 0; i < match[1].length; i++) {\n\t\t\tthis.params[match[1][i]] = m[i + 1];\n\t\t}\n\t\tthis.cmp = routes[key];\n\t}\n}\n\nfunction router(src) {\n  radi = src;\n  return function(ro) {\n\t  function getRoute(curr) {\n  \t\tif (lr === curr) return ld\n  \t\tif (!cr) cr = Object.keys(ro.routes);\n  \t\tif (!crg) crg = parseAllRoutes(cr);\n\t\t\tvar cahnged = false;\n\n  \t\tfor (var i = 0; i < crg.length; i++) {\n  \t\t\tif (crg[i][0].test(curr)) {\n  \t\t\t\tld = new Route(curr, crg[i], ro.routes, cr[i]);\n\t\t\t\t\tcahnged = true;\n  \t\t\t\tbreak\n  \t\t\t}\n  \t\t}\n\t\t\tif (!cahnged) {\n\t\t\t\tld = {\n\t\t\t\t\tkey: '/$error'\n\t\t\t\t};\n\t\t\t}\n\t\t\tlr = curr;\n  \t\treturn ld\n  \t}\n\n    // TODO: get rid of window variables\n    window.r_routes = ro.routes;\n    window.r_before = ro.beforeEach || true;\n    window.r_after = ro.afterEach || null;\n\n    var conds = '';\n    for (var route in ro.routes) {\n      conds = conds.concat(`cond(\n        l(this.active === '${route}' && (r_before === true || r_before('${route}',2))),\n        function () { var ret = r('div', new r_routes['${route}']()); if(r_after)r_after(); return ret; }\n      ).`);\n    }\n    if (conds !== '') conds = conds.concat('else(r(\\'div\\', \\'Error 404\\'))');\n\n    var fn = `return r('div', ${conds})`;\n\n    return radi.component({\n      name: 'radi-router',\n      view: new Function(fn),\n      state: {\n        // _radi_no_debug: true,\n        location: window.location.hash.substr(1) || '/',\n        last: null,\n        active: null\n      },\n      actions: {\n        onMount() {\n          window.onhashchange = this.hashChange;\n          this.hashChange();\n        },\n        hashChange() {\n\t\t\t\t\tthis.last = this.location;\n          this.location = window.location.hash.substr(1) || '/';\n          var a = getRoute(this.location);\n          if (a) {\n            this.active = a.key;\n          }\n          // console.log('[radi-router] Route change', a, this.location)\n        }\n      }\n    })\n  };\n}\n\nexports.default = router;\n\nexports.version = version;\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=radi-router.js.map\n"]}