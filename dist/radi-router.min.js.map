{"version":3,"sources":["dist/radi-router.js"],"names":["global","factory","exports","module","define","amd","this","radi","COLON","charCodeAt","cr","crg","lr","ld","parseRoute","route","parts","split","end","p","i","length","push","substr","RegExp","join","Route","[object Object]","curr","match","routes","key","m","path","params","cmp","default","src","mixin","ro","getRoute","Object","keys","arr","len","ret","Array","parseAllRoutes","cahnged","test","window","r_routes","r_before","beforeEach","r_after","afterEach","conds","concat","fn","mix","active","last","location","component","name","view","Function","state","hash","actions","onhashchange","hashChange","a","updateMixin","version"],"mappings":"CAAC,SAAUA,EAAQC,GACC,iBAAZC,SAA0C,oBAAXC,OAAyBF,EAAQC,SACrD,mBAAXE,QAAyBA,OAAOC,KACtCJ,EAASD,EAAO,mBAHlB,CAIEM,KAAM,SAAWJ,GAAW,aAG9B,IAAIK,EAEJ,MAAMC,EAAQ,IAAIC,WAAW,GAC7B,IAAIC,EACAC,EACAC,EACAC,EAEJ,SAASC,EAAWC,GAEnB,IADA,IAAIC,EAAQD,EAAME,MAAM,KAAMC,KAAUC,KAC/BC,EAAI,EAAGA,EAAIJ,EAAMK,OAAQD,IAC7BZ,IAAUQ,EAAMI,GAAGX,WAAW,IACjCS,EAAII,KAAK,YACTH,EAAEG,KAAKN,EAAMI,GAAGG,OAAO,KACA,KAAbP,EAAMI,IAChBF,EAAII,KAAKN,EAAMI,IAGjB,OAAQ,IAAII,OAAO,KAAON,EAAIO,KAAK,KAAO,eAAiB,KAAMN,SAY5DO,EACLC,YAAYC,EAAMC,EAAOC,EAAQC,GAChC,IAAIC,EAAIJ,EAAKC,MAAMA,EAAM,IACzBvB,KAAK2B,KAAOL,EACZtB,KAAKyB,IAAMA,EACXzB,KAAK4B,UACL,IAAK,IAAId,EAAI,EAAGA,EAAIS,EAAM,GAAGR,OAAQD,IACpCd,KAAK4B,OAAOL,EAAM,GAAGT,IAAMY,EAAEZ,EAAI,GAElCd,KAAK6B,IAAML,EAAOC,IAwFpB7B,EAAQkC,QApFR,SAAgBC,EAAKC,GAEnB,OADA/B,EAAO8B,EACA,SAASE,GACf,SAASC,EAASZ,GACjB,GAAIhB,IAAOgB,EAAM,OAAOf,EACnBH,IAAIA,EAAK+B,OAAOC,KAAKH,EAAGT,SACxBnB,IAAKA,EA5Bd,SAAwBgC,GAEvB,IADA,IAAIC,EAAMD,EAAItB,OAAQwB,EAAM,IAAIC,MAAMF,GAC7BxB,EAAIwB,EAAM,EAAGxB,GAAK,EAAGA,IAC7ByB,EAAIzB,GAAKN,EAAW6B,EAAIvB,IAEzB,OAAOyB,EAuBYE,CAAerC,IAG/B,IAFD,IAAIsC,GAAU,EAEJ5B,EAAI,EAAGA,EAAIT,EAAIU,OAAQD,IAC/B,GAAIT,EAAIS,GAAG,GAAG6B,KAAKrB,GAAO,CACzBf,EAAK,IAAIa,EAAME,EAAMjB,EAAIS,GAAImB,EAAGT,OAAQpB,EAAGU,IAC5C4B,GAAU,EACT,MAKF,OADDpC,EAAKgB,EACKoB,EAA6BnC,GAAjBkB,IAAK,UAI1BmB,OAAOC,SAAWZ,EAAGT,OACrBoB,OAAOE,SAAWb,EAAGc,aAAc,EACnCH,OAAOI,QAAUf,EAAGgB,WAAa,KAEjC,IAAIC,EAAQ,GACZ,IAAK,IAAIzC,KAASwB,EAAGT,OACnB0B,EAAQA,EAAMC,4CACS1C,yCAA6CA,oEACjBA,yDAGvC,KAAVyC,IAAcA,EAAQA,EAAMC,OAAO,gCAEvC,IAAIC,qBAAwBF,KAE1BG,EAAMrB,EAAM,WACfsB,OAAQ,GACR1B,UACA2B,KAAM,GACNC,SAAU,KAGT,OAAOvD,EAAKwD,WACVC,KAAM,cACNC,KAAM,IAAIC,SAASR,GACnBS,OAEEL,SAAUZ,OAAOY,SAASM,KAAK7C,OAAO,IAAM,IAC5CW,UACA2B,KAAM,KACND,OAAQ,MAEVS,SAEE1C,UAEEuB,OAAOoB,aAAehE,KAAKiE,WAC3BjE,KAAKiE,cAGP5C,aACHrB,KAAKuD,KAAOvD,KAAKwD,SACZxD,KAAKwD,SAAWZ,OAAOY,SAASM,KAAK7C,OAAO,IAAM,IAClD,IAAIiD,EAAIhC,EAASlC,KAAKwD,UAC3BxD,KAAK4B,OAASsC,EAAEtC,WAChB5B,KAAKmE,cACLnE,KAAKsD,OAASY,EAAEzC,KAAO,IAIxBJ,cACCgC,EAAIzB,OAAS5B,KAAK4B,OAClByB,EAAIC,OAAStD,KAAKsD,OAClBD,EAAIE,KAAOvD,KAAKuD,KAChBF,EAAIG,SAAWxD,KAAKwD,eAUzB5D,EAAQwE,QAlIQ","sourcesContent":["(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n\ttypeof define === 'function' && define.amd ? define(['exports'], factory) :\n\t(factory((global['radi-router'] = {})));\n}(this, (function (exports) { 'use strict';\n\nconst version = '0.1.8';\nvar radi;\n\nconst COLON = ':'.charCodeAt(0);\nvar cr;\nvar crg;\nvar lr;\nvar ld;\n\nfunction parseRoute(route) {\n\tvar parts = route.split('/'), end = [], p = [];\n\tfor (var i = 0; i < parts.length; i++) {\n\t\tif (COLON === parts[i].charCodeAt(0)) {\n\t\t\tend.push('([^\\/]+?)');\n\t\t\tp.push(parts[i].substr(1));\n\t\t} else if (parts[i] !== '') {\n\t\t\tend.push(parts[i]);\n\t\t}\n\t}\n\treturn [new RegExp('^/' + end.join('/') + '(?:\\/(?=$))?$', 'i'), p]\n}\n\nfunction parseAllRoutes(arr) {\n\tvar len = arr.length, ret = new Array(len);\n\tfor (var i = len - 1; i >= 0; i--) {\n\t\tret[i] = parseRoute(arr[i]);\n\t}\n\treturn ret\n}\n\n// TODO: Get rid of class\nclass Route {\n\tconstructor(curr, match, routes, key) {\n\t\tvar m = curr.match(match[0]);\n\t\tthis.path = curr;\n\t\tthis.key = key;\n\t\tthis.params = {};\n\t\tfor (var i = 0; i < match[1].length; i++) {\n\t\t\tthis.params[match[1][i]] = m[i + 1];\n\t\t}\n\t\tthis.cmp = routes[key];\n\t}\n}\n\nfunction router(src, mixin) {\n  radi = src;\n  return function(ro) {\n\t  function getRoute(curr) {\n  \t\tif (lr === curr) return ld\n  \t\tif (!cr) cr = Object.keys(ro.routes);\n  \t\tif (!crg) crg = parseAllRoutes(cr);\n\t\t\tvar cahnged = false;\n\n  \t\tfor (var i = 0; i < crg.length; i++) {\n  \t\t\tif (crg[i][0].test(curr)) {\n  \t\t\t\tld = new Route(curr, crg[i], ro.routes, cr[i]);\n\t\t\t\t\tcahnged = true;\n  \t\t\t\tbreak\n  \t\t\t}\n  \t\t}\n\n\t\t\tlr = curr;\n  \t\treturn (!cahnged) ? {key: '$error'} : ld\n  \t}\n\n    // TODO: get rid of window variables\n    window.r_routes = ro.routes;\n    window.r_before = ro.beforeEach || true;\n    window.r_after = ro.afterEach || null;\n\n    var conds = '';\n    for (var route in ro.routes) {\n      conds = conds.concat(`cond(\n        l(this.active === '${route}' && (r_before === true || r_before('${route}',2))),\n        function () { var ret = r('div', new r_routes['${route}']()); if(r_after)r_after(); return ret; }\n      ).`);\n    }\n    if (conds !== '') conds = conds.concat('else(r(\\'div\\', \\'Error 404\\'))');\n\n    var fn = `return r('div', ${conds})`;\n\n\t\tvar mix = mixin('$router', {\n\t\t\tactive: '',\n\t\t\tparams: {},\n\t\t\tlast: '',\n\t\t\tlocation: '',\n\t\t});\n\n    return radi.component({\n      name: 'radi-router',\n      view: new Function(fn),\n      state: {\n        // _radi_no_debug: true,\n        location: window.location.hash.substr(1) || '/',\n        params: {},\n        last: null,\n        active: null,\n      },\n      actions: {\n\n        onMount() {\n\t\t\t\t\t// this.updateMixin()\n          window.onhashchange = this.hashChange;\n          this.hashChange();\n        },\n\n        hashChange() {\n\t\t\t\t\tthis.last = this.location;\n          this.location = window.location.hash.substr(1) || '/';\n          var a = getRoute(this.location);\n\t\t\t\t\tthis.params = a.params || {};\n\t\t\t\t\tthis.updateMixin();\n\t\t\t\t\tthis.active = a.key || '';\n          // console.log('[radi-router] Route change', a, this.location)\n        },\n\n\t\t\t\tupdateMixin() {\n\t\t\t\t\tmix.params = this.params;\n\t\t\t\t\tmix.active = this.active;\n\t\t\t\t\tmix.last = this.last;\n\t\t\t\t\tmix.location = this.location;\n\t\t\t\t},\n\n      }\n    })\n  };\n}\n\nexports.default = router;\n\nexports.version = version;\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=radi-router.js.map\n"]}