{"version":3,"file":"radi-router.js","sources":["../src/index.js"],"sourcesContent":["export const version = '0.1.1'\nvar radi\n\nconst COLON = ':'.charCodeAt(0)\nvar cr, crg, lr, ld\n\nfunction parseRoute(route) {\n\tvar parts = route.split('/'), end = [], p = []\n\tfor (var i = 0; i < parts.length; i++) {\n\t\tif (COLON === parts[i].charCodeAt(0)) {\n\t\t\tend.push('([^\\/]+?)')\n\t\t\tp.push(parts[i].substr(1))\n\t\t} else if (parts[i] !== '') {\n\t\t\tend.push(parts[i])\n\t\t}\n\t}\n\treturn [new RegExp('^/' + end.join('/') + '(?:\\/(?=$))?$', 'i'), p]\n}\n\nfunction parseAllRoutes(arr) {\n\tvar len = arr.length, ret = new Array(len)\n\tfor (var i = len - 1; i >= 0; i--) {\n\t\tret[i] = parseRoute(arr[i])\n\t}\n\treturn ret\n}\n\nclass Route {\n\tconstructor(curr, match, routes, key) {\n\t\tvar m = curr.match(match[0])\n\t\tthis.path = curr\n\t\tthis.key = key\n\t\tthis.params = {}\n\t\tfor (var i = 0; i < match[1].length; i++) {\n\t\t\tthis.params[match[1][i]] = m[i + 1]\n\t\t}\n\t\tthis.cmp = routes[key]\n\t}\n}\n\nfunction router(src) {\n  radi = src\n  return function(ro) {\n\t  function getRoute(curr) {\n  \t\tif (lr === curr) return ld\n  \t\tif (!cr) cr = Object.keys(ro.routes)\n  \t\tif (!crg) crg = parseAllRoutes(cr)\n\n  \t\tfor (var i = 0; i < crg.length; i++) {\n  \t\t\tif (crg[i][0].test(curr)) {\n  \t\t\t\tld = new Route(curr, crg[i], ro.routes, cr[i])\n  \t\t\t\tbreak\n  \t\t\t}\n  \t\t}\n  \t\treturn ld\n  \t}\n\n    // TODO: get rid of window variables\n    window.r_routes = ro.routes\n    window.r_before = ro.beforeEach || true\n    window.r_after = ro.afterEach || null\n\n    var conds = ''\n    for (var route in ro.routes) {\n      conds = conds.concat(`cond(\n        l(this.active === '${route}' && (r_before === true || r_before('${route}',2))),\n        function () { var ret = r('div', new r_routes['${route}']()); if(r_after)r_after(); return ret; }\n      ).`)\n    }\n    if (conds !== '') conds = conds.concat('else(\\'Error 404\\')')\n\n    var fn = `return r('div', ${conds})`\n\n    return radi.component({\n      name: 'radi-router',\n      view: new Function(fn),\n      state: {\n        // _radi_no_debug: true,\n        location: window.location.hash.substr(1),\n        active: null\n      },\n      actions: {\n        onMount() {\n          window.onhashchange = this.hashChange\n          this.hashChange()\n        },\n        hashChange() {\n          this.location = window.location.hash.substr(1)\n          var a = getRoute(this.location)\n          if (a) {\n            this.active = a.key\n          }\n          // console.log('[radi-router] Route change', a)\n        }\n      }\n    })\n  };\n};\n\nexports.default = router;\n"],"names":[],"mappings":"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"}