{"version":3,"file":"radi-router.js","sources":["../src/index.js"],"sourcesContent":["export const version = '0.4.0';\n\n// Pass routes to initiate things\nexport default ({\n    r,\n    l,\n    mount,\n    headless,\n    Component,\n  }, routes) => {\n  let current = {};\n\n  const COLON = ':'.charCodeAt(0);\n  const SLASH = '/'.charCodeAt(0);\n  var cr, crg, lr, ld;\n\n  const parseRoute = route => {\n    var parts = route.split('/'),\n      end = [],\n      p = [];\n    for (var i = 0; i < parts.length; i++) {\n      if (COLON === parts[i].charCodeAt(0)) {\n        end.push('([^/]+?)');\n        p.push(parts[i].substr(1));\n      } else if (parts[i] !== '') {\n        end.push(parts[i]);\n      }\n    }\n    return [new RegExp('^/' + end.join('/') + '(?:[/])?(?:[?&].*)?$', 'i'), p];\n  };\n\n  const parseAllRoutes = arr => {\n    var len = arr.length,\n      ret = new Array(len);\n    for (var i = len - 1; i >= 0; i--) {\n      ret[i] = parseRoute(arr[i]);\n    }\n    return ret;\n  };\n\n  const renderError = number => {\n    return current.config.errors[number]();\n  };\n\n  const writeUrl = url => {\n    window.location.hash = url;\n    return true;\n  };\n\n  const extractChildren = routes => {\n    let children = routes;\n    for (let child in routes) {\n      if (routes.hasOwnProperty(child) && routes[child].children) {\n        let extracted = extractChildren(routes[child].children);\n        for (var nn in extracted) {\n          if (extracted.hasOwnProperty(nn)) {\n            children[child + nn] = extracted[nn];\n          }\n        }\n      }\n    }\n    return children;\n  };\n\n  const getRoute = curr => {\n    if (lr === curr) return ld;\n    if (!cr) cr = Object.keys(current.routes);\n    if (!crg) crg = parseAllRoutes(cr);\n    var cahnged = false;\n\n    for (var i = 0; i < crg.length; i++) {\n      if (crg[i][0].test(curr)) {\n        ld = new Route(curr, crg[i], current.routes, cr[i]);\n        cahnged = true;\n        break;\n      }\n    }\n\n    lr = curr;\n    return !cahnged ? { key: null } : ld;\n  };\n\n  class Route {\n    constructor(curr, match, routes, key) {\n      const query = curr\n        .split(/[\\?\\&]/)\n        .slice(1)\n        .map(query => query.split('='))\n        .reduce(\n          (acc, key) =>\n            Object.assign(acc, {\n              [key[0]]: key[1]\n            }),\n          {}\n        );\n      var m = curr.match(match[0]);\n      this.path = curr;\n      this.key = key;\n      this.query = query;\n      this.cmp = routes[key] || {};\n      this.params = this.cmp.data || {};\n      for (var i = 0; i < match[1].length; i++) {\n        this.params[match[1][i]] = m[i + 1];\n      }\n    }\n  }\n\n  const combineTitle = (...args) => (\n    args.reduce((a, v) => (v ? a.concat(v) : a), [])\n  );\n\n  class Title extends Component {\n    constructor(...args) {\n      super(...args);\n      this.state = {\n        prefix: null,\n        text: null,\n        suffix: null,\n        seperator: ' | ',\n      };\n    }\n\n    setPrefix(prefix) {\n      return this.setState({prefix});\n    }\n\n    setSuffix(suffix) {\n      return this.setState({suffix});\n    }\n\n    set(text) {\n      return this.setState({text});\n    }\n\n    setSeperator(seperator) {\n      return this.setState({seperator});\n    }\n\n    onUpdate() {\n      let titleConfig = this.$router.getTitle() || {};\n\n      let pefix = (routes.title && routes.title.prefix) || this.state.prefix;\n      let text = titleConfig.text || (routes.title && routes.title.text) || this.state.text;\n      let suffix = (routes.title && routes.title.suffix) || this.state.suffix;\n\n      let title = combineTitle(\n        pefix,\n        text,\n        suffix\n      ).join(this.state.seperator);\n\n      if (title && document.title !== title) {\n        document.title = title;\n      }\n\n      if (this.state.text && text !== this.state.text) {\n        this.set(null);\n      }\n    }\n  }\n\n  class RouterHead extends Component {\n    constructor(...args) {\n      super(...args);\n      this.state = {\n        location: window.location.hash.substr(1) || '/',\n        params: {},\n        query: {},\n        last: null,\n        active: null,\n        activeComponent: null,\n        current: {\n          title: null,\n          tags: [],\n          meta: {},\n        },\n      };\n    }\n\n    onMount() {\n      window.onhashchange = () => (this.setState(this.hashChange()), this.chain());\n      this.setState(this.hashChange());\n      this.chain();\n    }\n\n    chain() {\n      this.trigger('changed', this.state.active || '', this.state.last);\n    }\n\n    hashChange() {\n      var loc = window.location.hash.substr(1) || '/';\n      var a = getRoute(loc);\n\n      // console.log('[radi-router] Route change', a, this.state.location);\n\n      window.scrollTo(0, 0);\n\n      // this.resolve(this.inject(a.key || '', this.state.active))\n\n      let title = a.cmp && a.cmp.title;\n\n      return {\n        last: this.state.active,\n        location: loc,\n        params: a.params || {},\n        query: a.query || {},\n        active: a.key || '',\n        current: {\n          title: (typeof title === 'object') ? title : {\n            text: title,\n          } || null,\n          tags: (a.cmp && a.cmp.tags) || [],\n          meta: (a.cmp && a.cmp.meta) || {},\n        },\n      }\n    }\n\n    hasTag(...tag) {\n      return tag.reduce((acc, t) => acc || (this.state.current.tags.indexOf(t) >= 0), false);\n    }\n\n    getMeta() {\n      return this.state.current.meta || {};\n    }\n\n    getTitle() {\n      let title = this.state.current.title;\n\n      return title;\n    }\n\n  }\n\n  class Link extends Component {\n    constructor(...args) {\n      super(...args);\n      this.state = {\n        to: '/',\n        active: 'active',\n        core: false,\n        class: '',\n        id: null,\n        title: null,\n      };\n    }\n    view() {\n      return r(\n        'a',\n        {\n          href: l(this, 'to').process(url => '#'.concat(url)),\n          class: l(this, 'to').process(to =>\n            l(this.$router, 'active').process(active =>\n              l(this, 'class').process(cls => ([\n                (active === to || (this.state.core && new RegExp('^' + to).test(active)))\n                  && this.state.active,\n                cls\n              ]))\n            )\n          ),\n          id: l(this, 'id'),\n          title: l(this, 'title'),\n        },\n        ...this.children\n      );\n    }\n  }\n\n  class Router extends Component {\n\n    constructor(...args) {\n      super(...args);\n      this.state = {\n        active: null,\n      };\n    }\n\n    onMount() {\n      this.setState({active: this.$router.state.active});\n      this.$router.on('changed', (active, last) => {\n        this.setState({active});\n      });\n    }\n\n    view() {\n      // return [\n      //   l(this.$router, 'active').process(() => r('div', {}, this.inject(this.$router.state))),\n      //   ...this.children,\n      // ];\n      return [\n        l(this, 'active').process(comp => this.extractComponent(comp)),\n        this.children,\n      ]\n      // return r(\n      //   'template',\n      //   {},\n      //   l(this, 'active').process(comp => this.extractComponent(comp)),\n      //   this.children,\n      // );\n      // return [\n      //   l(this.$router, 'activeComponent').process(comp => comp),\n      //   this.children,\n      // ]\n      // return r(\n      //   'template',\n      //   {},\n      //   l(this.$router, 'activeComponent').process(comp => comp),\n      //   this.children,\n      // );\n    }\n\n    // Triggers when route is changed\n    extractComponent(active, last) {\n      // Route is not yet ready\n      // For the future, maybe show cached page or default screen\n      // or loading placeholder if time between this and next request\n      // is too long\n      if (active === null && typeof last === 'undefined') return;\n\n      // const { active, last } = this.state\n      const RouteComponent = current.routes[active];\n      const WillRender =\n        typeof RouteComponent === 'object'\n          ? RouteComponent.component\n          : RouteComponent;\n\n      // Route not found or predefined error\n      if (\n        (typeof WillRender === 'undefined' ||\n          typeof WillRender === 'number' ||\n          !WillRender) &&\n        typeof RouteComponent === 'undefined'\n      )\n        return renderError(WillRender || 404);\n\n      // Plain redirect\n      if (typeof RouteComponent.redirect === 'string')\n        return writeUrl(RouteComponent.redirect);\n\n      // Check if has any guards to check\n      const guards = [\n        current.before || null,\n        RouteComponent.before || null,\n      ].filter(guard => typeof guard === 'function');\n\n      if (guards.length > 0) {\n        const checkGuard = (resolve, reject) => {\n          const popped = guards.pop();\n\n          if (typeof popped !== 'function') {\n            return resolve(WillRender);\n          }\n\n          return popped.call(this, active, last, act => {\n            // Render\n            if (typeof act === 'undefined' || act === true) {\n              if (guards.length > 0) {\n                return checkGuard(resolve, reject);\n              } else {\n                return resolve(WillRender);\n              }\n            }\n\n            if (act) {\n              if (guards.length > 0) {\n                return checkGuard(resolve, reject);\n              } else {\n                return resolve(act);\n              }\n            }\n\n            // Redirect\n            // if (typeof act === 'string' && act.charCodeAt(0) === SLASH) {\n            //   reject();\n            //   return writeUrl(act);\n            // }\n\n            // Restricted\n            return resolve(renderError(403));\n          });\n        };\n\n        return () => new Promise(checkGuard);\n      }\n\n      if (typeof WillRender === 'function') {\n        // Route is component\n        if (WillRender.isComponent && WillRender.isComponent())\n          return r(WillRender);\n\n        // Route is plain function\n        return WillRender;\n      }\n\n      // Route is plain text/object\n      return WillRender;\n    }\n  }\n\n  const before = routes.beforeEach;\n  const after = routes.afterEach;\n\n  const getError = (code, fallback) => {\n    let error = routes.errors && routes.errors[code];\n\n    if (error) {\n      return typeof error === 'function' ? error : () => error;\n    }\n\n    return fallback;\n  };\n\n  current = {\n    config: {\n      errors: {\n        404: getError(404, () => r('div', {}, 'Error 404: Not Found')),\n        403: getError(403, () => r('div', {}, 'Error 403: Forbidden')),\n      },\n    },\n    before,\n    after,\n    routes: extractChildren(routes.routes),\n    write: writeUrl,\n    Link,\n    Router,\n  };\n\n  // Initiates router component\n  headless('router', RouterHead);\n\n  // Initiates title component\n  headless('title', Title);\n\n  return current;\n};\n"],"names":[],"mappings":"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"}