{"version":3,"file":"radi-router.js","sources":["../src/index.js"],"sourcesContent":["export const version = '0.3.1';\n\n// Pass routes to initiate things\nexport default ({\n    r,\n    l,\n    mount,\n    headless,\n    Component,\n  }, routes) => {\n  let current = {};\n\n  const COLON = ':'.charCodeAt(0);\n  const SLASH = '/'.charCodeAt(0);\n  var cr, crg, lr, ld;\n\n  const parseRoute = route => {\n    var parts = route.split('/'),\n      end = [],\n      p = [];\n    for (var i = 0; i < parts.length; i++) {\n      if (COLON === parts[i].charCodeAt(0)) {\n        end.push('([^/]+?)');\n        p.push(parts[i].substr(1));\n      } else if (parts[i] !== '') {\n        end.push(parts[i]);\n      }\n    }\n    return [new RegExp('^/' + end.join('/') + '(?:[/])?(?:[?&].*)?$', 'i'), p];\n  };\n\n  const parseAllRoutes = arr => {\n    var len = arr.length,\n      ret = new Array(len);\n    for (var i = len - 1; i >= 0; i--) {\n      ret[i] = parseRoute(arr[i]);\n    }\n    return ret;\n  };\n\n  const renderError = number => {\n    return current.config.errors[number]();\n  };\n\n  const writeUrl = url => {\n    window.location.hash = url;\n    return true;\n  };\n\n  const guard = (before, comp, active, last, resolve, reject, deep) => {\n    return before(active, last, act => {\n      if (typeof act === 'undefined' || act === true) {\n        if (typeof deep === 'function') {\n          return guard(deep, comp, active, last, resolve, reject, null);\n        } else {\n          resolve({ default: comp });\n        }\n      } else if (typeof act === 'string' && act.charCodeAt(0) === SLASH) {\n        writeUrl(act);\n        return reject();\n      } else {\n        resolve({ default: renderError(403) });\n      }\n\n      // Fire afterEach event in routes\n      if (current.after) current.after(active, last);\n    });\n  };\n\n  const getRoute = curr => {\n    if (lr === curr) return ld;\n    if (!cr) cr = Object.keys(current.routes);\n    if (!crg) crg = parseAllRoutes(cr);\n    var cahnged = false;\n\n    for (var i = 0; i < crg.length; i++) {\n      if (crg[i][0].test(curr)) {\n        ld = new Route(curr, crg[i], current.routes, cr[i]);\n        cahnged = true;\n        break;\n      }\n    }\n\n    lr = curr;\n    return !cahnged ? { key: null } : ld;\n  };\n\n  class Route {\n    constructor(curr, match, routes, key) {\n      const query = curr\n        .split(/[\\?\\&]/)\n        .slice(1)\n        .map(query => query.split('='))\n        .reduce(\n          (acc, key) =>\n            Object.assign(acc, {\n              [key[0]]: key[1]\n            }),\n          {}\n        );\n      var m = curr.match(match[0]);\n      this.path = curr;\n      this.key = key;\n      this.query = query;\n      this.cmp = routes[key];\n      this.params = this.cmp.data || {};\n      for (var i = 0; i < match[1].length; i++) {\n        this.params[match[1][i]] = m[i + 1];\n      }\n    }\n  }\n\n  class RouterHead extends Component {\n    state() {\n      return {\n        location: window.location.hash.substr(1) || '/',\n        params: {},\n        query: {},\n        last: null,\n        active: null\n      };\n    }\n\n    on() {\n      return {\n        mount() {\n          window.onhashchange = () => this.setState(this.hashChange());\n          this.setState(this.hashChange());\n        }\n      }\n    }\n\n    hashChange() {\n      var loc = window.location.hash.substr(1) || '/';\n      var a = getRoute(loc);\n\n      console.log('[radi-router] Route change', a, this.state.location);\n\n      return {\n        last: this.state.active,\n        location: loc,\n        params: a.params || {},\n        query: a.query || {},\n        active: a.key || '',\n      }\n    }\n  }\n\n  class Link extends Component {\n    state() {\n      return {\n        to: '/',\n        active: 'active',\n        class: '',\n        id: null,\n        title: null,\n      };\n    }\n    view() {\n      return r(\n        'a',\n        {\n          href: l(this, 'to').process(url => '#'.concat(url)),\n          class: l(this, 'to').process(to =>\n            l(this.$router, 'active').process(active =>\n              l(this, 'class').process(cls =>\n                ((active === to ? 'active' : '') + ' ' + cls))\n            )\n          ),\n          id: l(this, 'id'),\n          title: l(this, 'title'),\n        },\n        ...this.children\n      );\n    }\n  }\n\n  class Router extends Component {\n    // Triggers when route is changed\n    inject({ active, last }) {\n      const RouteComponent = current.routes[active];\n      const WillRender =\n        typeof RouteComponent === 'object'\n          ? RouteComponent.component\n          : RouteComponent;\n\n      // Route not found or predefined error\n      if (\n        (typeof WillRender === 'undefined' ||\n          typeof WillRender === 'number' ||\n          !WillRender) &&\n        typeof RouteComponent === 'undefined'\n      )\n        return renderError(WillRender || 404);\n\n      // Plain redirect\n      if (typeof RouteComponent.redirect === 'string')\n        return writeUrl(RouteComponent.redirect);\n\n      // Check if has any guards to check\n      if (\n        typeof current.before === 'function' ||\n        typeof RouteComponent.before === 'function'\n      ) {\n        return () =>\n          new Promise((resolve, reject) => {\n            // Global guard\n            if (typeof current.before === 'function') {\n              guard(\n                current.before,\n                WillRender,\n                active,\n                last,\n                resolve,\n                reject,\n                RouteComponent.before\n              );\n            } else if (typeof RouteComponent.before === 'function') {\n              guard(\n                RouteComponent.before,\n                WillRender,\n                active,\n                last,\n                resolve,\n                reject,\n                null\n              );\n            }\n          });\n      }\n\n      if (typeof WillRender === 'function') {\n        // Route is component\n        if (WillRender.isComponent && WillRender.isComponent())\n          return r(WillRender);\n\n        // Route is plain function\n        return WillRender;\n      }\n\n      // Route is plain text/object\n      return WillRender;\n    }\n\n    view() {\n      return [\n        l(this.$router, 'active').process(() => this.inject(this.$router.state)),\n        ...this.children,\n      ];\n      // return r(\n      //   'template',\n      //   {},\n      //   l(this.$router, 'active').process(() => this.inject(this.$router.state)),\n      //   ...this.children,\n      // );\n    }\n  }\n\n  const before = routes.beforeEach;\n  const after = routes.afterEach;\n\n  current = {\n    config: {\n      errors: {\n        404: () => r('div', {}, 'Error 404: Not Found'),\n        403: () => r('div', {}, 'Error 403: Forbidden')\n      }\n    },\n    before,\n    after,\n    routes: routes.routes,\n    write: writeUrl,\n    Link,\n    Router\n  };\n\n  // Initiates router component\n  headless('router', RouterHead);\n\n  return current;\n};\n"],"names":[],"mappings":";;;;;;AAAO,MAAM,OAAO,GAAG,OAAO,CAAC;;;AAG/B,YAAe,CAAC;IACZ,CAAC;IACD,CAAC;IACD,KAAK;IACL,QAAQ;IACR,SAAS;GACV,EAAE,MAAM,KAAK;EACd,IAAI,OAAO,GAAG,EAAE,CAAC;;EAEjB,MAAM,KAAK,GAAG,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;EAChC,MAAM,KAAK,GAAG,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;EAChC,IAAI,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,CAAC;;EAEpB,MAAM,UAAU,GAAG,KAAK,IAAI;IAC1B,IAAI,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC;MAC1B,GAAG,GAAG,EAAE;MACR,CAAC,GAAG,EAAE,CAAC;IACT,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;MACrC,IAAI,KAAK,KAAK,KAAK,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,EAAE;QACpC,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACrB,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;OAC5B,MAAM,IAAI,KAAK,CAAC,CAAC,CAAC,KAAK,EAAE,EAAE;QAC1B,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;OACpB;KACF;IACD,OAAO,CAAC,IAAI,MAAM,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,sBAAsB,EAAE,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;GAC5E,CAAC;;EAEF,MAAM,cAAc,GAAG,GAAG,IAAI;IAC5B,IAAI,GAAG,GAAG,GAAG,CAAC,MAAM;MAClB,GAAG,GAAG,IAAI,KAAK,CAAC,GAAG,CAAC,CAAC;IACvB,KAAK,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;MACjC,GAAG,CAAC,CAAC,CAAC,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;KAC7B;IACD,OAAO,GAAG,CAAC;GACZ,CAAC;;EAEF,MAAM,WAAW,GAAG,MAAM,IAAI;IAC5B,OAAO,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,CAAC;GACxC,CAAC;;EAEF,MAAM,QAAQ,GAAG,GAAG,IAAI;IACtB,MAAM,CAAC,QAAQ,CAAC,IAAI,GAAG,GAAG,CAAC;IAC3B,OAAO,IAAI,CAAC;GACb,CAAC;;EAEF,MAAM,KAAK,GAAG,CAAC,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,MAAM,EAAE,IAAI,KAAK;IACnE,OAAO,MAAM,CAAC,MAAM,EAAE,IAAI,EAAE,GAAG,IAAI;MACjC,IAAI,OAAO,GAAG,KAAK,WAAW,IAAI,GAAG,KAAK,IAAI,EAAE;QAC9C,IAAI,OAAO,IAAI,KAAK,UAAU,EAAE;UAC9B,OAAO,KAAK,CAAC,IAAI,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;SAC/D,MAAM;UACL,OAAO,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;SAC5B;OACF,MAAM,IAAI,OAAO,GAAG,KAAK,QAAQ,IAAI,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,KAAK,KAAK,EAAE;QACjE,QAAQ,CAAC,GAAG,CAAC,CAAC;QACd,OAAO,MAAM,EAAE,CAAC;OACjB,MAAM;QACL,OAAO,CAAC,EAAE,OAAO,EAAE,WAAW,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;OACxC;;;MAGD,IAAI,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,KAAK,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;KAChD,CAAC,CAAC;GACJ,CAAC;;EAEF,MAAM,QAAQ,GAAG,IAAI,IAAI;IACvB,IAAI,EAAE,KAAK,IAAI,EAAE,OAAO,EAAE,CAAC;IAC3B,IAAI,CAAC,EAAE,EAAE,EAAE,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;IAC1C,IAAI,CAAC,GAAG,EAAE,GAAG,GAAG,cAAc,CAAC,EAAE,CAAC,CAAC;IACnC,IAAI,OAAO,GAAG,KAAK,CAAC;;IAEpB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;MACnC,IAAI,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;QACxB,EAAE,GAAG,IAAI,KAAK,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;QACpD,OAAO,GAAG,IAAI,CAAC;QACf,MAAM;OACP;KACF;;IAED,EAAE,GAAG,IAAI,CAAC;IACV,OAAO,CAAC,OAAO,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC;GACtC,CAAC;;EAEF,MAAM,KAAK,CAAC;IACV,WAAW,CAAC,IAAI,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG,EAAE;MACpC,MAAM,KAAK,GAAG,IAAI;SACf,KAAK,CAAC,QAAQ,CAAC;SACf,KAAK,CAAC,CAAC,CAAC;SACR,GAAG,CAAC,KAAK,IAAI,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;SAC9B,MAAM;UACL,CAAC,GAAG,EAAE,GAAG;YACP,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE;cACjB,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;aACjB,CAAC;UACJ,EAAE;SACH,CAAC;MACJ,IAAI,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;MAC7B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;MACjB,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;MACf,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;MACnB,IAAI,CAAC,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;MACvB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,IAAI,EAAE,CAAC;MAClC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QACxC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;OACrC;KACF;GACF;;EAED,MAAM,UAAU,SAAS,SAAS,CAAC;IACjC,KAAK,GAAG;MACN,OAAO;QACL,QAAQ,EAAE,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,GAAG;QAC/C,MAAM,EAAE,EAAE;QACV,KAAK,EAAE,EAAE;QACT,IAAI,EAAE,IAAI;QACV,MAAM,EAAE,IAAI;OACb,CAAC;KACH;;IAED,EAAE,GAAG;MACH,OAAO;QACL,KAAK,GAAG;UACN,MAAM,CAAC,YAAY,GAAG,MAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC;UAC7D,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC;SAClC;OACF;KACF;;IAED,UAAU,GAAG;MACX,IAAI,GAAG,GAAG,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,GAAG,CAAC;MAChD,IAAI,CAAC,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC;;MAEtB,OAAO,CAAC,GAAG,CAAC,4BAA4B,EAAE,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;;MAElE,OAAO;QACL,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM;QACvB,QAAQ,EAAE,GAAG;QACb,MAAM,EAAE,CAAC,CAAC,MAAM,IAAI,EAAE;QACtB,KAAK,EAAE,CAAC,CAAC,KAAK,IAAI,EAAE;QACpB,MAAM,EAAE,CAAC,CAAC,GAAG,IAAI,EAAE;OACpB;KACF;GACF;;EAED,MAAM,IAAI,SAAS,SAAS,CAAC;IAC3B,KAAK,GAAG;MACN,OAAO;QACL,EAAE,EAAE,GAAG;QACP,MAAM,EAAE,QAAQ;QAChB,KAAK,EAAE,EAAE;QACT,EAAE,EAAE,IAAI;QACR,KAAK,EAAE,IAAI;OACZ,CAAC;KACH;IACD,IAAI,GAAG;MACL,OAAO,CAAC;QACN,GAAG;QACH;UACE,IAAI,EAAE,CAAC,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,OAAO,CAAC,GAAG,IAAI,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;UACnD,KAAK,EAAE,CAAC,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,OAAO,CAAC,EAAE;YAC7B,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC,OAAO,CAAC,MAAM;cACtC,CAAC,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC,OAAO,CAAC,GAAG;iBACzB,CAAC,MAAM,KAAK,EAAE,GAAG,QAAQ,GAAG,EAAE,IAAI,GAAG,GAAG,GAAG,CAAC,CAAC;aACjD;WACF;UACD,EAAE,EAAE,CAAC,CAAC,IAAI,EAAE,IAAI,CAAC;UACjB,KAAK,EAAE,CAAC,CAAC,IAAI,EAAE,OAAO,CAAC;SACxB;QACD,GAAG,IAAI,CAAC,QAAQ;OACjB,CAAC;KACH;GACF;;EAED,MAAM,MAAM,SAAS,SAAS,CAAC;;IAE7B,MAAM,CAAC,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE;MACvB,MAAM,cAAc,GAAG,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;MAC9C,MAAM,UAAU;QACd,OAAO,cAAc,KAAK,QAAQ;YAC9B,cAAc,CAAC,SAAS;YACxB,cAAc,CAAC;;;MAGrB;QACE,CAAC,OAAO,UAAU,KAAK,WAAW;UAChC,OAAO,UAAU,KAAK,QAAQ;UAC9B,CAAC,UAAU;QACb,OAAO,cAAc,KAAK,WAAW;;QAErC,OAAO,WAAW,CAAC,UAAU,IAAI,GAAG,CAAC,CAAC;;;MAGxC,IAAI,OAAO,cAAc,CAAC,QAAQ,KAAK,QAAQ;QAC7C,OAAO,QAAQ,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;;;MAG3C;QACE,OAAO,OAAO,CAAC,MAAM,KAAK,UAAU;QACpC,OAAO,cAAc,CAAC,MAAM,KAAK,UAAU;QAC3C;QACA,OAAO;UACL,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAK;;YAE/B,IAAI,OAAO,OAAO,CAAC,MAAM,KAAK,UAAU,EAAE;cACxC,KAAK;gBACH,OAAO,CAAC,MAAM;gBACd,UAAU;gBACV,MAAM;gBACN,IAAI;gBACJ,OAAO;gBACP,MAAM;gBACN,cAAc,CAAC,MAAM;eACtB,CAAC;aACH,MAAM,IAAI,OAAO,cAAc,CAAC,MAAM,KAAK,UAAU,EAAE;cACtD,KAAK;gBACH,cAAc,CAAC,MAAM;gBACrB,UAAU;gBACV,MAAM;gBACN,IAAI;gBACJ,OAAO;gBACP,MAAM;gBACN,IAAI;eACL,CAAC;aACH;WACF,CAAC,CAAC;OACN;;MAED,IAAI,OAAO,UAAU,KAAK,UAAU,EAAE;;QAEpC,IAAI,UAAU,CAAC,WAAW,IAAI,UAAU,CAAC,WAAW,EAAE;UACpD,OAAO,CAAC,CAAC,UAAU,CAAC,CAAC;;;QAGvB,OAAO,UAAU,CAAC;OACnB;;;MAGD,OAAO,UAAU,CAAC;KACnB;;IAED,IAAI,GAAG;MACL,OAAO;QACL,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC,OAAO,CAAC,MAAM,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QACxE,GAAG,IAAI,CAAC,QAAQ;OACjB,CAAC;;;;;;;KAOH;GACF;;EAED,MAAM,MAAM,GAAG,MAAM,CAAC,UAAU,CAAC;EACjC,MAAM,KAAK,GAAG,MAAM,CAAC,SAAS,CAAC;;EAE/B,OAAO,GAAG;IACR,MAAM,EAAE;MACN,MAAM,EAAE;QACN,GAAG,EAAE,MAAM,CAAC,CAAC,KAAK,EAAE,EAAE,EAAE,sBAAsB,CAAC;QAC/C,GAAG,EAAE,MAAM,CAAC,CAAC,KAAK,EAAE,EAAE,EAAE,sBAAsB,CAAC;OAChD;KACF;IACD,MAAM;IACN,KAAK;IACL,MAAM,EAAE,MAAM,CAAC,MAAM;IACrB,KAAK,EAAE,QAAQ;IACf,IAAI;IACJ,MAAM;GACP,CAAC;;;EAGF,QAAQ,CAAC,QAAQ,EAAE,UAAU,CAAC,CAAC;;EAE/B,OAAO,OAAO,CAAC;CAChB,CAAC;;;;;;;;;;;;;"}