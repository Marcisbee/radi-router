{"version":3,"file":"radi-router.es.js","sources":["../src/index.js"],"sourcesContent":["export const version = '0.2.3';\n\n// Pass routes to initiate things\nexport default ({\n    r,\n    l,\n    mount,\n    headless,\n    component,\n  }, routes) => {\n  let current = {};\n\n  const COLON = ':'.charCodeAt(0);\n  const SLASH = '/'.charCodeAt(0);\n  var cr, crg, lr, ld;\n\n  const parseRoute = route => {\n    var parts = route.split('/'),\n      end = [],\n      p = [];\n    for (var i = 0; i < parts.length; i++) {\n      if (COLON === parts[i].charCodeAt(0)) {\n        end.push('([^/]+?)');\n        p.push(parts[i].substr(1));\n      } else if (parts[i] !== '') {\n        end.push(parts[i]);\n      }\n    }\n    return [new RegExp('^/' + end.join('/') + '(?:[/])?(?:[?&].*)?$', 'i'), p];\n  };\n\n  const parseAllRoutes = arr => {\n    var len = arr.length,\n      ret = new Array(len);\n    for (var i = len - 1; i >= 0; i--) {\n      ret[i] = parseRoute(arr[i]);\n    }\n    return ret;\n  };\n\n  const renderError = number => {\n    return current.config.errors[number]();\n  };\n\n  const writeUrl = url => {\n    window.location.hash = url;\n    return true;\n  };\n\n  const guard = (before, comp, active, last, resolve, reject, deep) => {\n    return before(active, last, act => {\n      if (typeof act === 'undefined' || act === true) {\n        if (typeof deep === 'function') {\n          return guard(deep, comp, active, last, resolve, reject, null);\n        } else {\n          resolve({ default: comp });\n        }\n      } else if (typeof act === 'string' && act.charCodeAt(0) === SLASH) {\n        writeUrl(act);\n        return reject();\n      } else {\n        resolve({ default: renderError(403) });\n      }\n\n      // Fire afterEach event in routes\n      if (current.after) current.after(active, last);\n    });\n  };\n\n  const getRoute = curr => {\n    if (lr === curr) return ld;\n    if (!cr) cr = Object.keys(current.routes);\n    if (!crg) crg = parseAllRoutes(cr);\n    var cahnged = false;\n\n    for (var i = 0; i < crg.length; i++) {\n      if (crg[i][0].test(curr)) {\n        ld = new Route(curr, crg[i], current.routes, cr[i]);\n        cahnged = true;\n        break;\n      }\n    }\n\n    lr = curr;\n    return !cahnged ? { key: null } : ld;\n  };\n\n  class Route {\n    constructor(curr, match, routes, key) {\n      const query = curr\n        .split(/[\\?\\&]/)\n        .slice(1)\n        .map(query => query.split('='))\n        .reduce(\n          (acc, key) =>\n            Object.assign(acc, {\n              [key[0]]: key[1]\n            }),\n          {}\n        );\n      var m = curr.match(match[0]);\n      this.path = curr;\n      this.key = key;\n      this.query = query;\n      this.cmp = routes[key];\n      this.params = this.cmp.data || {};\n      for (var i = 0; i < match[1].length; i++) {\n        this.params[match[1][i]] = m[i + 1];\n      }\n    }\n  }\n\n  const RouterHead = component({\n    name: 'HeadlessRouter',\n    state: {\n      location: window.location.hash.substr(1) || '/',\n      params: {},\n      query: {},\n      last: null,\n      active: null\n    },\n    actions: {\n      onMount(state) {\n        window.onhashchange = () => this.hashChange(state);\n        this.hashChange(state);\n      },\n\n      hashChange(state) {\n        state.last = state.active;\n        state.location = window.location.hash.substr(1) || '/';\n        var a = getRoute(state.location);\n        state.params = a.params || {};\n        state.query = a.query || {};\n        state.active = a.key || '';\n        console.log('[radi-router] Route change', a, state.location);\n      }\n    }\n  });\n\n  const Link = component({\n    name: 'RouterLink',\n    props: {\n      to: '/',\n      active: 'active',\n      class: '',\n      title: null,\n    },\n    view(comp) {\n      return r(\n        'a',\n        {\n          href: l(comp, 'to').process(url => '#'.concat(url)),\n          class: l(comp, 'to').process(to =>\n            l(comp.$router, 'active').process(active =>\n              l(comp, 'class').process(cls =>\n                ((active === to ? 'active' : '') + ' ' + cls))\n            )\n          ),\n          title: l(comp, 'title')\n        },\n        ...comp.children\n      );\n    }\n  });\n\n  const Router = component({\n    name: 'Router',\n    actions: {\n      // Triggers when route is chaned\n      inject({ active, last }) {\n        const RouteComponent = current.routes[active];\n        const WillRender =\n          typeof RouteComponent === 'object'\n            ? RouteComponent.component\n            : RouteComponent;\n\n        // Route not found or predefined error\n        if (\n          (typeof WillRender === 'undefined' ||\n            typeof WillRender === 'number' ||\n            !WillRender) &&\n          typeof RouteComponent === 'undefined'\n        )\n          return renderError(WillRender || 404);\n\n  \t\t\t// Plain redirect\n  \t\t\tif (typeof RouteComponent.redirect === 'string')\n  \t      return writeUrl(RouteComponent.redirect);\n\n        // Check if has any guards to check\n        if (\n          typeof current.before === 'function' ||\n          typeof RouteComponent.before === 'function'\n        ) {\n          return () =>\n            new Promise((resolve, reject) => {\n              // Global guard\n              if (typeof current.before === 'function') {\n                guard(\n                  current.before,\n                  WillRender,\n                  active,\n                  last,\n                  resolve,\n                  reject,\n                  RouteComponent.before\n                );\n              } else if (typeof RouteComponent.before === 'function') {\n                guard(\n                  RouteComponent.before,\n                  WillRender,\n                  active,\n                  last,\n                  resolve,\n                  reject,\n                  null\n                );\n              }\n            });\n        }\n\n        if (typeof WillRender === 'function') {\n          // Route is component\n          if (WillRender.isComponent && WillRender.isComponent())\n            return r(WillRender);\n\n          // Route is plain function\n          return WillRender;\n        }\n\n        // Route is plain text/object\n        return WillRender;\n      }\n    },\n    view(comp) {\n      return r(\n        'div',\n        {},\n        l(comp.$router, 'active').process(() => comp.inject(comp.$router)),\n        ...comp.children\n      );\n    }\n  });\n\n  const before = routes.beforeEach;\n  const after = routes.afterEach;\n\n  current = {\n    config: {\n      errors: {\n        404: () => r('div', {}, 'Error 404: Not Found'),\n        403: () => r('div', {}, 'Error 403: Forbidden')\n      }\n    },\n    before,\n    after,\n    routes: routes.routes,\n    write: writeUrl,\n    Link,\n    Router\n  };\n\n  // Initiates router component\n  headless('router', RouterHead);\n\n  return current;\n};\n"],"names":[],"mappings":"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"}