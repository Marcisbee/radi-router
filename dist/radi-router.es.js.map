{"version":3,"file":"radi-router.es.js","sources":["../src/index.js"],"sourcesContent":["export const version = '0.5.0';\n\n// Pass routes to initiate things\nconst RadiRouter = ({\n    h,\n    Action,\n    Await,\n    Event,\n    Merge,\n    Service,\n    Store,\n    customAttribute,\n  }, routes = []) => {\n  if (!routes) {\n    console.warn('[Radi:Router] Routes should be set as a second parameter');\n  }\n  let current = {};\n\n  const COLON = ':'.charCodeAt(0);\n  const SLASH = '/'.charCodeAt(0);\n  var cr, crg, lr, ld;\n\n  const parseRoute = route => {\n    var parts = route.split('/'),\n      end = [],\n      p = [];\n    for (var i = 0; i < parts.length; i++) {\n      if (COLON === parts[i].charCodeAt(0)) {\n        end.push('([^/]+?)');\n        p.push(parts[i].substr(1));\n      } else if (parts[i] !== '') {\n        end.push(parts[i]);\n      }\n    }\n    return [new RegExp('^/' + end.join('/') + '(?:[/])?(?:[?&].*)?$', 'i'), p];\n  };\n\n  const parseAllRoutes = arr => {\n    var len = arr.length,\n      ret = new Array(len);\n    for (var i = len - 1; i >= 0; i--) {\n      ret[i] = parseRoute(arr[i]);\n    }\n    return ret;\n  };\n\n  const renderError = number => {\n    return current.config.errors[number]();\n  };\n\n  const writeUrl = url => {\n    window.location.hash = url;\n    return true;\n  };\n\n  const extractChildren = routes => {\n    let children = routes;\n    for (let child in routes) {\n      if (routes.hasOwnProperty(child) && routes[child].children) {\n        let extracted = extractChildren(routes[child].children);\n        for (var nn in extracted) {\n          if (extracted.hasOwnProperty(nn)) {\n            children[child + nn] = extracted[nn];\n          }\n        }\n      }\n    }\n    return children;\n  };\n\n  const getRoute = (curr) => {\n    if (!current.routes) return null;\n    if (lr === curr) return ld;\n    if (!cr) cr = Object.keys(current.routes);\n    if (!crg) crg = parseAllRoutes(cr);\n    var cahnged = false;\n\n    for (var i = 0; i < crg.length; i++) {\n      if (crg[i][0].test(curr)) {\n        ld = new Route(curr, crg[i], current.routes, cr[i]);\n        cahnged = true;\n        break;\n      }\n    }\n\n    lr = curr;\n    return !cahnged ? { key: null } : ld;\n  };\n\n  class Route {\n    constructor(curr, match, routes, key) {\n      const query = curr\n        .split(/[\\?\\&]/)\n        .slice(1)\n        .map(query => query.split('='))\n        .reduce(\n          (acc, key) =>\n            Object.assign(acc, {\n              [key[0]]: key[1]\n            }),\n          {}\n        );\n      var m = curr.match(match[0]);\n      this.path = curr;\n      this.key = key;\n      this.query = query;\n      this.cmp = routes[key] || {};\n      this.params = this.cmp.data || {};\n      for (var i = 0; i < match[1].length; i++) {\n        this.params[match[1][i]] = m[i + 1];\n      }\n    }\n  }\n\n  const combineTitle = (...args) => (\n    args.reduce((a, v) => (v ? a.concat(v) : a), [])\n  );\n\n  const getHash = () => location.hash.substr(1) || '/';\n  const getPath = () => decodeURI(location.pathname + location.search) || '/';\n\n  const mode = routes.mode === 'hash'\n    ? 'hash'\n    : 'history';\n  \n  const getRealPath = mode === 'hash' ? getHash : getPath;\n\n  const routeUpdate = mode === 'hash'\n    ? Event(window).on('hashchange', () => getRealPath())\n    : Event(window).on('popstate', () => getRealPath());\n  \n  const routeUpdateStore = Store(getRealPath())\n    .on(routeUpdate, () => getRealPath());\n  \n  const RouterStore = Merge([\n    routeUpdateStore,\n    Store({\n      params: {},\n      query: {},\n      current: {\n        title: null,\n        tags: [],\n        meta: {},\n      },\n    }),\n  ], null)\n    .map(([route, state]) => {\n      if (!state || !route) return {};\n      var loc = mode === 'hash' ? getHash() : getPath();\n      var a = getRoute(loc) || {};\n\n      // console.log('[radi-router] Route change', a);\n\n      window.scrollTo(0, 0);\n\n      // this.resolve(this.inject(a.key || '', this.state.active))\n\n      let title = a.cmp && a.cmp.title;\n      const reHashed = route.split('#');\n\n      if (Service.Title) Service.Title.set(title);\n\n      return {\n        route: reHashed[0].split(/[\\?\\&]/)[0],\n        hash: reHashed[1],\n        last: state.active,\n        location: loc,\n        params: a.params || {},\n        query: a.query || {},\n        active: a.key || '',\n        current: {\n          title: (typeof title === 'object') ? title : {\n            text: title,\n          } || null,\n          tags: (a.cmp && a.cmp.tags) || [],\n          meta: (a.cmp && a.cmp.meta) || {},\n        },\n      };\n    });\n\n  customAttribute('route', (e, value) => {\n    if (mode === 'history') {\n      e.onclick = (ev) => {\n        ev.preventDefault();\n\n        RouterStore.push(value);\n      };\n      e.href = value;\n      return;\n    }\n\n    e.href = '#' + value;\n  }, {\n    addToElement: false,\n  });\n\n  customAttribute('href', (e, value) => {\n    if (mode === 'history') {\n\n      if (value[0] === '/' && value[1] !== '/') {\n        e.onclick = (ev) => {\n          ev.preventDefault();\n\n          RouterStore.push(value);\n        };\n      }\n\n      return value;\n    }\n\n    if (value[0] === '#') return RouterStore.listener(({route}) => (\n      '#' + route + value\n    ));\n\n    return '#' + value;\n  }, {\n    allowedTags: ['a'],\n    addToElement: true,\n  });\n\n  function evalFn(fn) {\n    if (typeof fn === 'function') return evalFn(fn());\n    if (typeof fn === 'object' && fn.default) return evalFn(fn.default);\n    return fn;\n  }\n\n  // Triggers when route is changed\n  function extractComponent(active, route, last) {\n    // Route is not yet ready\n    // For the future, maybe show cached page or default screen\n    // or loading placeholder if time between this and next request\n    // is too long\n    if (active === null && typeof last === 'undefined') return;\n\n    // const { active, last } = this.state\n    const RouteComponent = current.routes[active] || current.routes[route];\n    const WillRender =\n      typeof RouteComponent === 'object'\n        ? RouteComponent.component\n        : RouteComponent;\n\n    // Route not found or predefined error\n    if (\n      (typeof WillRender === 'undefined' ||\n        typeof WillRender === 'number' ||\n        !WillRender) &&\n      typeof RouteComponent === 'undefined'\n    )\n      return renderError(WillRender || 404);\n\n    // Plain redirect\n    if (typeof RouteComponent.redirect === 'string')\n      return writeUrl(RouteComponent.redirect);\n\n    // Check if has any guards to check\n    const guards = [\n      current.before || null,\n      RouteComponent.before || null,\n    ].filter(guard => typeof guard === 'function');\n\n    if (guards.length > 0) {\n      const checkGuard = (resolve, reject) => {\n        const popped = guards.pop();\n\n        if (typeof popped !== 'function') {\n          return resolve(WillRender);\n        }\n\n        return popped(active, last, act => {\n          // Render\n          if (typeof act === 'undefined' || act === true) {\n            if (guards.length > 0) {\n              return checkGuard(resolve, reject);\n            } else {\n              return resolve(WillRender);\n            }\n          }\n\n          if (act) {\n            if (guards.length > 0) {\n              return checkGuard(resolve, reject);\n            } else {\n              return resolve(act);\n            }\n          }\n\n          // Redirect\n          // if (typeof act === 'string' && act.charCodeAt(0) === SLASH) {\n          //   reject();\n          //   return writeUrl(act);\n          // }\n\n          // Restricted\n          return resolve(renderError(403));\n        }, RouterStore.getRawState());\n      };\n\n      // return h('div', {}, h('await', {src: new Promise(checkGuard)}));\n      return new Promise(checkGuard);\n    }\n\n    // Route is plain text/object\n    return WillRender;\n  }\n\n  // Components\n  function RouterBody({ placeholder, waitMs }) {\n    const { route, active, last } = RouterStore.state;\n\n    const src = new Promise(resolve => {\n      const evaluated = evalFn(extractComponent(active, route, last));\n\n      if (evaluated instanceof Promise) {\n        evaluated.then(resolve);\n      } else {\n        resolve(evaluated);\n      }\n    });\n\n    return h(Await, { src, placeholder, waitMs });\n  }\n\n  function QueryToUrl(query) {\n    let url = '';\n    let n = url.split('?').length - 1\n    for (let i in query) {\n      if (typeof query[i] !== 'undefined') {\n        url = url.concat(((!n) ? '?' : '&') + i + '=' + query[i])\n        n += 1\n      }\n    }\n    return url;\n  }\n\n  RouterStore.push = function push(url) {\n    if (url[0] === '/' && url[1] !== '/') {\n      history.pushState(null, null, url);\n      routeUpdate(getPath);\n    }\n  };\n\n  RouterStore.query = function push(data) {\n    const state = RouterStore.getRawState();\n    const url = state.location.split(/[\\?\\&]/)[0];\n\n    const search = (typeof data === 'function')\n      ? QueryToUrl(data(state.query))\n      : QueryToUrl(data);\n\n    RouterStore.push(url + search);\n  };\n\n  RouterStore.replace = function replace(url) {\n    if (url[0] === '/' && url[1] !== '/') {\n      history.replaceState(null, null, url);\n      routeUpdate(getPath);\n    }\n  };\n\n  const modifyTitle = Action('Modify Title');\n\n  const titleState = Store({\n    prefix: null,\n    text: null,\n    suffix: 'Radi.js',\n    seperator: ' | ',\n  }, null)\n    .on(modifyTitle, (state, payload) => ({ ...state, ...payload }));\n\n  class Title {\n    constructor() {\n      this.onUpdate = this.onUpdate.bind(this);\n      titleState.subscribe(this.onUpdate);\n    }\n\n    setPrefix(prefix) {\n      return modifyTitle({ prefix });\n    }\n\n    setSuffix(suffix) {\n      return modifyTitle({ suffix });\n    }\n\n    set(text) {\n      return modifyTitle({ text });\n    }\n\n    setSeperator(seperator) {\n      return modifyTitle({ seperator });\n    }\n\n    onUpdate(state) {\n      let titleConfig = state || {};\n\n      let pefix = (routes.title && routes.title.prefix) || titleConfig.prefix;\n      let text = titleConfig.text || (routes.title && routes.title.text) || titleConfig.text;\n      let suffix = (routes.title && routes.title.suffix) || titleConfig.suffix;\n\n      let title = combineTitle(\n        pefix,\n        text,\n        suffix\n      ).join(titleConfig.seperator);\n\n      if (title && document.title !== title) {\n        document.title = title;\n      }\n\n      if (titleConfig.text && text !== titleConfig.text) {\n        this.set(null);\n      }\n    }\n  }\n\n  const before = routes.beforeEach;\n  const after = routes.afterEach;\n\n  const getError = (code, fallback) => {\n    let error = routes.errors && routes.errors[code];\n\n    if (error) {\n      return typeof error === 'function' ? error : () => error;\n    }\n\n    return fallback;\n  };\n\n  current = {\n    config: {\n      errors: {\n        404: getError(404, () => h('div', {}, 'Error 404: Not Found')),\n        403: getError(403, () => h('div', {}, 'Error 403: Forbidden')),\n      },\n    },\n    before,\n    after,\n    routes: extractChildren(routes.routes),\n    write: writeUrl,\n    Router: RouterBody,\n  };\n\n  // Initiates router store\n  Service.add('Router', () => RouterStore);\n\n  // Initiates title plugin\n  Service.add('Title', () => new Title());\n\n  // Initiates router body component\n  Service.add('RouterBody', () => RouterBody);\n\n  return current;\n};\n\nif (typeof window !== 'undefined') window.RadiRouter = RadiRouter;\nexport default RadiRouter;\n"],"names":["const","let"],"mappings":"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"}